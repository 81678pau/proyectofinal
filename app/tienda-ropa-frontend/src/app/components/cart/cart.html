<div class="cart-container">
  <h2>Shopping Bag</h2>

  <!-- Mensaje de estado -->
  <div *ngIf="mensaje" class="alert" [ngClass]="mensaje.includes('Exito') ? 'alert-success' : 'alert-danger'">
    {{ mensaje }}
  </div>

  <div *ngIf="carrito.cart().length > 0; else emptyCart" class="cart-layout">

    <!-- Left Column: Items -->
    <div class="cart-items">
      <div *ngFor="let item of carrito.cart()" class="cart-item">
        <!-- Imagen del producto (Placeholder si no hay) -->
        <img [src]="item.product.imageUrl || 'assets/placeholder.png'" alt="{{ item.product.name }}" class="item-image"
          onerror="this.src='https://placehold.co/120x160?text=No+Image'">

        <div class="item-details">
          <h3>{{ item.product.name }}</h3>
          <p class="price">${{ item.product.price | number:'1.2-2' }}</p>

          <div class="item-controls">
            <!-- Selector de Cantidad -->
            <div class="quantity-selector">
              <button (click)="carrito.updateQuantity(item.product.productId, -1)"
                [disabled]="item.quantity <= 1">−</button>
              <span>{{ item.quantity }}</span>
              <button (click)="carrito.updateQuantity(item.product.productId, 1)">+</button>
            </div>

            <!-- Botón Eliminar -->
            <button class="btn-remove" (click)="carrito.removeFromCart(item.product.productId)" title="Eliminar">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </div>

        <div class="item-total">
          ${{ (item.product.price * item.quantity) | number:'1.2-2' }}
        </div>
      </div>
    </div>

    <!-- Right Column: Summary -->
    <div class="cart-summary">
      <h3>Resumen del Pedido</h3>

      <div class="summary-row">
        <span>Valor del pedido</span>
        <span>${{ carrito.getTotal() | number:'1.2-2' }}</span>
      </div>
      <div class="summary-row">
        <span>Envío</span>
        <span>Gratis</span>
      </div>

      <div class="summary-row total">
        <span>Total</span>
        <span>${{ carrito.getTotal() | number:'1.2-2' }}</span>
      </div>

      <button class="btn-checkout" (click)="onCheckout()">
        Finalizar Compra
      </button>

      <button class="btn-clear" (click)="carrito.clearCart()">
        Vaciar bolsa
      </button>
    </div>

  </div>

  <ng-template #emptyCart>
    <div class="empty-state">
      <p>Tu bolsa de compras está vacía.</p>
      <a routerLink="/productos" class="btn-shop">Ver novedades</a>
    </div>
  </ng-template>
</div>